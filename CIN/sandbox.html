<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIN Sandbox</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .building {
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
        }

        .resource {
            margin: 10px;
        }

        button {
            margin: 5px;
        }

        .resource-input {
            margin-right: 5px;
        }
    </style>
</head>

<body>

    <h1>Customizable Game</h1>

    <h2><a href="https://neucleardog.github.io/CIN">Go to Uncustomizable Version</a></h2>

    <h2>Set Starting Resources</h2>
    <div>
        Copper: <input type="number" id="copperInput" class="resource-input" value="0"><br>
        Lead: <input type="number" id="leadInput" class="resource-input" value="0"><br>
        Electricity: <input type="number" id="electricityInput" class="resource-input" value="0"><br>
        Water: <input type="number" id="waterInput" class="resource-input" value="0"><br>
        Coal: <input type="number" id="coalInput" class="resource-input" value="0"><br>
        Graphite: <input type="number" id="graphiteInput" class="resource-input" value="0"><br>
    </div>
    <button onclick="setStartingResources()">Set Resources</button>

    <h2>Available Buildings</h2>
    <div id="buildingsContainer"></div>

    <h2>Export Configuration</h2>
    <button onclick="exportData()">Export Game Data</button>
    <textarea id="importData" placeholder='Paste your JSON here...' rows="10" style="width:100%;"></textarea>
    <button onclick="importData()">Import Game Data</button>

    <h2>Resource Display</h2>
    <div id="resourceDisplay"></div>

    <h2>Manage Resources</h2>
    <input type="text" id="newResourceName" placeholder="New Resource Name">
    <button onclick="addResource()">Add Resource</button>
    <div id="resourceManagementContainer"></div>

    <script>
        // Predefined buildings
        const predefinedBuildings = [
            {
                name: "Copper Mine",
                cost: { copper: 10, lead: 5 },
                production: { electricity: 0, water: 0, coal: 1, graphite: 0 }
            },
            {
                name: "Solar Panel",
                cost: { copper: 15, lead: 5 },
                production: { electricity: 5, water: 0, coal: 0, graphite: 0 }
            },
            {
                name: "Coal Plant",
                cost: { copper: 20, lead: 10 },
                production: { electricity: 10, water: 0, coal: -2, graphite: 0 }
            }
        ];

        // Game variables
        let resources = {
            copper: 0,
            lead: 0,
            electricity: 0,
            water: 0,
            coal: 0,
            graphite: 0
        };

        let buildings = predefinedBuildings.map(building => ({ ...building, count: 0 })); // Initialize buildings

        // Initialize resource display
        function updateResourceDisplay() {
            const resourceDisplay = document.getElementById('resourceDisplay');
            resourceDisplay.innerHTML = "<strong>Resources:</strong><br>";
            for (const [key, value] of Object.entries(resources)) {
                resourceDisplay.innerHTML += `
                    <div class="resource">${key}: ${value} 
                    <button onclick="removeResource('${key}')">Delete Resource</button></div>`;
            }
        }

        // Function to set starting resources
        function setStartingResources() {
            resources.copper = parseInt(document.getElementById('copperInput').value) || 0;
            resources.lead = parseInt(document.getElementById('leadInput').value) || 0;
            resources.electricity = parseInt(document.getElementById('electricityInput').value) || 0;
            resources.water = parseInt(document.getElementById('waterInput').value) || 0;
            resources.coal = parseInt(document.getElementById('coalInput').value) || 0;
            resources.graphite = parseInt(document.getElementById('graphiteInput').value) || 0;

            updateResourceDisplay();
            alert("Starting resources set!");
        }

        // Function to create and display building elements
        function createBuilding(building) {
            const buildingDiv = document.createElement('div');
            buildingDiv.className = 'building';
            buildingDiv.innerHTML = `
                <strong>${building.name}</strong><br>
                Cost: ${JSON.stringify(building.cost)}<br>
                Production: ${JSON.stringify(building.production)}<br>
                Active Instances: <span id="count-${building.name}">${building.count}</span>
                <button onclick="changeBuildingCount('${building.name}', 1)">+</button>
                <button onclick="changeBuildingCount('${building.name}', -1)">-</button>
                <button onclick="build('${building.name}')">Buy Building</button>
                <button onclick="deleteBuilding('${building.name}')">Delete Building</button>
            `;
            document.getElementById('buildingsContainer').appendChild(buildingDiv);
        }

        // Function to change the number of active instances of a building
        function changeBuildingCount(name, delta) {
            const countElement = document.getElementById(`count-${name}`);
            let currentCount = parseInt(countElement.innerText) || 0;

            if (delta > 0) {
                currentCount++;
            } else if (delta < 0 && currentCount > 0) {
                currentCount--;
            }

            countElement.innerText = currentCount;

            // Update count in buildings array
            const building = buildings.find(b => b.name === name);
            building.count = currentCount;

            // Update production based on active instances
            updateProduction();
        }

        // Function to update production rates based on active instances
        function updateProduction() {
            const productionRates = {};
            buildings.forEach(building => {
                for (const [resource, amount] of Object.entries(building.production)) {
                    const count = building.count; // Get current count
                    if (!(resource in productionRates)) {
                        productionRates[resource] = 0;
                    }
                    productionRates[resource] += amount * count; // Total production based on active instances
                }
            });

            // Update resources every second based on production rates
            for (const [resource, amount] of Object.entries(productionRates)) {
                if (resources[resource] !== undefined) {
                    resources[resource] += amount;
                }
            }

            updateResourceDisplay();
        }

        // Start production loop
        setInterval(updateProduction, 1000); // Update every second

        // Function to build a building
        function build(name) {
            const building = buildings.find(b => b.name === name);
            const canBuild = Object.keys(building.cost).every(resource =>
                resources[resource] >= building.cost[resource]
            );

            if (canBuild) {
                Object.keys(building.cost).forEach(resource => {
                    resources[resource] -= building.cost[resource];
                });

                alert(`${building.name} built successfully! Instances: ${building.count}`);
            } else {
                alert("Not enough resources to build " + name);
            }
        }

        // Function to delete a building from the display (reset count)
        function deleteBuilding(name) {
            const countElement = document.getElementById(`count-${name}`);
            countElement.innerText = 0; // Reset active instances to 0
            const building = buildings.find(b => b.name === name);
            building.count = 0; // Reset count in buildings array
            updateProduction(); // Update production
            alert(`${name} deleted successfully!`);
        }

        // Function to remove a resource
        function removeResource(name) {
            delete resources[name];
            updateResourceDisplay();
        }

        // Function to create a new number input for building costs
        function addCostField() {
            const container = document.getElementById('costInputContainer');
            const input = document.createElement('input');
            input.placeholder = 'Cost (e.g., copper: 10)';
            input.className = 'cost-input';
            container.appendChild(input);
        }

        // Function to create a new number input for building production
        function addProductionField() {
            const container = document.getElementById('productionInputContainer');
            const input = document.createElement('input');
            input.placeholder = 'Production (e.g., electricity: 5)';
            input.className = 'production-input';
            container.appendChild(input);
        }

        // Function to create a new number input for building capacity
        function addCapacityField() {
            const container = document.getElementById('capacityInputContainer');
            const input = document.createElement('input');
            input.placeholder = 'Capacity (e.g., electricity: 20)';
            input.className = 'capacity-input';
            container.appendChild(input);
        }

        // Function to export game data as JSON
        function exportData() {
            const gameData = {
                resources: resources,
                buildings: buildings // Include buildings with counts
            };
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(gameData));
            const a = document.createElement("a");
            a.href = dataStr;
            a.download = "game_data.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Function to import game data from JSON
        function importData() {
            try {
                const data = JSON.parse(document.getElementById('importData').value);
                resources = data.resources;
                buildings.forEach(building => {
                    const importedBuilding = data.buildings.find(b => b.name === building.name);
                    if (importedBuilding) {
                        building.count = importedBuilding.count;
                    } else {
                        building.count = 0;
                    }
                });
                // Update displays
                updateResourceDisplay();
                buildings.forEach(building => createBuilding(building));
                alert("Game data imported successfully!");
            } catch (error) {
                alert("Failed to import data. Please check the format.");
            }
        }

        // Pre-populate the buildings in the display
        predefinedBuildings.forEach(building => createBuilding(building));

        // Initialize the game display
        updateResourceDisplay();
        updateResourceManagement();

    </script>

</body>

</html>
